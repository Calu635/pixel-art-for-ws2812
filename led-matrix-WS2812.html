<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Éditeur de Pixel Art pour Matrice LED (8x32)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Styles personnalisés pour le canvas et les éléments */
        body {
            font-family: "Inter", sans-serif;
            background-color: #1a202c; /* Dark background default */
            color: #e2e8f0; /* Light text default */
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            transition: background-color 0.3s, color 0.3s; /* Smooth transition for theme change */
        }
        body.light-theme {
            background-color: #f7fafc; /* Light background */
            color: #2d3748; /* Dark text */
        }
        canvas {
            border: 2px solid #4a5568;
            background-color: #2d3748;
            cursor: crosshair;
            touch-action: none; /* Prevent browser touch actions */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            transition: background-color 0.3s, border-color 0.3s;
        }
        body.light-theme canvas {
            border-color: #cbd5e0;
            background-color: #edf2f7;
        }
        .controls-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 20px;
            justify-content: center;
            width: 100%;
            max-width: 800px;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s, background-image 0.2s, color 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            background-image: linear-gradient(to bottom right, #4a5568, #2d3748);
            border: 1px solid #6b7280;
            color: #e2e8f0;
        }
        .btn:hover {
            background-image: linear-gradient(to bottom right, #6b7280, #4a5568);
            transform: translateY(-1px);
        }
        .btn:active {
            transform: translateY(0);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        body.light-theme .btn {
            background-image: linear-gradient(to bottom right, #e2e8f0, #cbd5e0);
            border-color: #a0aec0;
            color: #2d3748;
        }
        body.light-theme .btn:hover {
            background-image: linear-gradient(to bottom right, #cbd5e0, #a0aec0);
        }
        .color-picker-wrapper, .language-selector-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: #2d3748;
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid #4a5568;
            transition: background-color 0.3s, border-color 0.3s;
        }
        body.light-theme .color-picker-wrapper, body.light-theme .language-selector-wrapper {
            background-color: #edf2f7;
            border-color: #cbd5e0;
        }
        input[type="color"] {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            width: 40px;
            height: 40px;
            border: none;
            background: none;
            cursor: pointer;
            border-radius: 5px;
            overflow: hidden;
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 5px;
        }
        input[type="color"]::-moz-color-swatch-wrapper {
            padding: 0;
        }
        input[type="color"]::-moz-color-swatch {
            border: none;
            border-radius: 5px;
        }
        select {
            background-color: #1a202c;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%23e2e8f0" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
            background-repeat: no-repeat;
            background-position: right 8px top 50%;
            background-size: 16px auto;
        }
        body.light-theme select {
            background-color: #f7fafc;
            border-color: #cbd5e0;
            color: #2d3748;
            background-image: url('data:image/svg+xml;utf8,<svg fill="%232d3748" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/><path d="M0 0h24v24H0z" fill="none"/></svg>');
        }
        textarea {
            background-color: #1a202c;
            border: 1px solid #4a5568;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            resize: vertical;
            min-height: 150px;
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        body.light-theme textarea {
            background-color: #f7fafc;
            border-color: #cbd5e0;
            color: #2d3748;
        }
        .message-box {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            display: none; /* Hidden by default */
            flex-direction: column;
            align-items: center;
            gap: 15px;
            border: 1px solid #4a5568;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        body.light-theme .message-box {
            background-color: #edf2f7;
            border-color: #cbd5e0;
            color: #2d3748;
        }
        .message-box button {
            background-color: #4a5568;
            color: #e2e8f0;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
        }
        .message-box button:hover {
            background-color: #6b7280;
        }
        body.light-theme .message-box button {
            background-color: #a0aec0;
            color: #2d3748;
        }
        body.light-theme .message-box button:hover {
            background-color: #cbd5e0;
        }

        /* Styles for the color palette */
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
            padding: 10px;
            background-color: #2d3748;
            border-radius: 8px;
            border: 1px solid #4a5568;
            transition: background-color 0.3s, border-color 0.3s;
        }
        body.light-theme .color-palette {
            background-color: #edf2f7;
            border-color: #cbd5e0;
        }
        .color-box {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            cursor: pointer;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.2);
            transition: transform 0.1s, border-color 0.2s;
        }
        .color-box:hover {
            transform: translateY(-2px);
            border-color: #a0aec0;
        }
        .color-box.selected {
            border: 2px solid #63b3ed; /* Highlight selected color */
            transform: scale(1.1);
        }
        footer {
            margin-top: 40px;
            padding: 10px;
            font-size: 0.85em;
            color: #718096; /* Gray text for footer */
            text-align: center;
            width: 100%;
            max-width: 800px;
        }
        body.light-theme footer {
            color: #4a5568;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 flex flex-col items-center p-4">

    <h1 class="text-3xl font-bold mb-6 text-blue-300" data-i18n="title">Éditeur de Pixel Art pour Matrice LED (8x32)</h1>

    <canvas id="pixelCanvas" class="rounded-lg shadow-lg" width="640" height="160"></canvas>

    <div class="controls-container">
        <div class="color-picker-wrapper">
            <label for="colorPicker" class="font-semibold text-gray-300" data-i18n="color_label">Couleur:</label>
            <input type="color" id="colorPicker" value="#00FF00">
        </div>

        <div class="color-palette" id="colorPalette">
        </div>

        <div class="language-selector-wrapper">
            <label for="languageSelector" class="font-semibold text-gray-300" data-i18n="language_label">Langue:</label>
            <select id="languageSelector">
                <option value="fr" data-i18n="lang_fr">Français</option>
                <option value="en" data-i18n="lang_en">English</option>
                <option value="es" data-i18n="lang_es">Español</option>
                <option value="zh-CN" data-i18n="lang_zh-CN">中文 (简体)</option>
                <option value="hi" data-i18n="lang_hi">हिन्दी</option>
                <option value="ar" data-i18n="lang_ar">العربية</option>
                <option value="bn" data-i18n="lang_bn">বাংলা</option>
                <option value="pt" data-i18n="lang_pt">Português</option>
                <option value="ru" data-i18n="lang_ru">Русский</option>
                <option value="ja" data-i18n="lang_ja">日本語</option>
                <option value="de" data-i18n="lang_de">Deutsch</option>
            </select>
        </div>

        <button id="clearButton" class="btn" data-i18n="clear_button">Effacer tout</button>
        <button id="generateButton" class="btn bg-green-600 hover:bg-green-700" data-i18n="generate_button">Générer le code Adafruit</button>
        <button id="copyButton" class="btn bg-blue-600 hover:bg-blue-700" data-i18n="copy_button">Copier le code</button>
        <button id="themeToggleButton" class="btn" data-i18n="theme_toggle">Thème (Foncé/Clair)</button>
    </div>

    <textarea id="outputCode" readonly data-i18n-placeholder="output_placeholder" placeholder="Le code Adafruit généré apparaîtra ici."></textarea>

    <div id="messageBox" class="message-box">
        <p id="messageText"></p>
        <button id="messageBoxOk" data-i18n="ok_button">OK</button>
    </div>

    <footer class="text-gray-500">
        <p data-i18n="footer_text">Ce site a été créé par un grand modèle linguistique, entraîné par Google.</p>
    </footer>

    <script>
        // Dimensions de la matrice LED
        const MATRIX_WIDTH = 32;
        const MATRIX_HEIGHT = 8;
        // Taille de chaque pixel sur le canvas
        const PIXEL_SIZE = 20;
        // Nombre total de pixels
        const NUMPIXELS = MATRIX_WIDTH * MATRIX_HEIGHT;

        const canvas = document.getElementById('pixelCanvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        const colorPalette = document.getElementById('colorPalette');
        const clearButton = document.getElementById('clearButton');
        const generateButton = document.getElementById('generateButton');
        const copyButton = document.getElementById('copyButton');
        const themeToggleButton = document.getElementById('themeToggleButton');
        const outputCode = document.getElementById('outputCode');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const messageBoxOk = document.getElementById('messageBoxOk');
        const languageSelector = document.getElementById('languageSelector');

        // Initialisation de la matrice de pixels avec des couleurs noires (0x000000)
        let pixels = Array(MATRIX_HEIGHT).fill(0).map(() => Array(MATRIX_WIDTH).fill('#000000'));
        let isDrawing = false; // Indicateur pour le dessin continu

        // Couleurs prédéfinies pour la palette
        const predefinedColors = [
            '#000000', // Noir
            '#FFFFFF', // Blanc
            '#FF0000', // Rouge
            '#00FF00', // Vert
            '#0000FF', // Bleu
            '#FFFF00', // Jaune
            '#FF00FF', // Magenta
            '#00FFFF', // Cyan
            '#FFA500', // Orange
            '#800080', // Violet
            '#A52A2A', // Marron
            '#7CFC00'  // Vert gazon
        ];

        // Dictionnaire des traductions
        const translations = {
            fr: {
                title: "Éditeur de Pixel Art pour Matrice LED (8x32)",
                color_label: "Couleur:",
                language_label: "Langue:",
                clear_button: "Effacer tout",
                generate_button: "Générer le code Adafruit",
                copy_button: "Copier le code",
                theme_toggle: "Thème (Foncé/Clair)",
                output_placeholder: "Le code Adafruit généré apparaîtra ici.",
                msg_copied_success: "Code généré et copié dans le presse-papiers ! Collez-le dans votre IDE Arduino.",
                msg_copy_manual: "Code généré, mais impossible de copier automatiquement. Veuillez copier manuellement.",
                msg_copy_error: "Erreur lors de la copie automatique: ",
                msg_clipboard_copied: "Code copié dans le presse-papiers !",
                msg_clipboard_fail: "Impossible de copier le code.",
                msg_copy_error_general: "Erreur lors de la copie: ",
                ok_button: "OK",
                footer_text: "Ce site a été créé par un grand modèle linguistique, entraîné par Google.",
                lang_fr: "Français",
                lang_en: "English",
                lang_es: "Español",
                lang_zh_CN: "中文 (简体)",
                lang_hi: "हिन्दी",
                lang_ar: "العربية",
                lang_bn: "বাংলা",
                lang_pt: "Português",
                lang_ru: "Русский",
                lang_ja: "日本語",
                lang_de: "Deutsch",
                code_comments_line1: "// Code généré pour une matrice WS2812 8x32 (256 pixels) en zig-zag colonne par colonne",
                code_comments_line2: "// Colonnes paires: du bas vers le haut. Colonnes impaires: du haut vers le bas.",
                code_comments_line3: "// Compatible avec la bibliothèque Adafruit NeoPixel",
                code_comments_loop1: "// Définition des couleurs des pixels",
                code_comments_loop2: "// Conversion du canvas (row, col) vers l'index linéaire NeoPixel selon le motif zig-zag colonne par colonne"
            },
            en: {
                title: "Pixel Art Editor for LED Matrix (8x32)",
                color_label: "Color:",
                language_label: "Language:",
                clear_button: "Clear All",
                generate_button: "Generate Adafruit Code",
                copy_button: "Copy Code",
                theme_toggle: "Theme (Dark/Light)",
                output_placeholder: "Generated Adafruit code will appear here.",
                msg_copied_success: "Code generated and copied to clipboard! Paste it into your Arduino IDE.",
                msg_copy_manual: "Code generated, but automatic copy failed. Please copy manually.",
                msg_copy_error: "Automatic copy error: ",
                msg_clipboard_copied: "Code copied to clipboard!",
                msg_clipboard_fail: "Failed to copy code.",
                msg_copy_error_general: "Copy error: ",
                ok_button: "OK",
                footer_text: "This site was created by a large language model, trained by Google.",
                lang_fr: "French",
                lang_en: "English",
                lang_es: "Spanish",
                lang_zh_CN: "Chinese (Simplified)",
                lang_hi: "Hindi",
                lang_ar: "Arabic",
                lang_bn: "Bengali",
                lang_pt: "Portuguese",
                lang_ru: "Russian",
                lang_ja: "Japanese",
                lang_de: "German",
                code_comments_line1: "// Code generated for an 8x32 WS2812 LED matrix (256 pixels) in column-wise zig-zag",
                code_comments_line2: "// Even columns: bottom to top. Odd columns: top to bottom.",
                code_comments_line3: "// Compatible with Adafruit NeoPixel library",
                code_comments_loop1: "// Defining pixel colors",
                code_comments_loop2: "// Converting canvas (row, col) to linear NeoPixel index based on column-wise zig-zag pattern"
            },
            es: {
                title: "Editor de Pixel Art para Matriz LED (8x32)",
                color_label: "Color:",
                language_label: "Idioma:",
                clear_button: "Borrar todo",
                generate_button: "Generar Código Adafruit",
                copy_button: "Copiar Código",
                theme_toggle: "Tema (Oscuro/Claro)",
                output_placeholder: "El código Adafruit generado aparecerá aquí.",
                msg_copied_success: "¡Código generado y copiado al portapapeles! Pégalo en tu IDE de Arduino.",
                msg_copy_manual: "Código generado, pero la copia automática falló. Por favor, copie manualmente.",
                msg_copy_error: "Error de copia automática: ",
                msg_clipboard_copied: "¡Código copiado al portapapeles!",
                msg_clipboard_fail: "No se pudo copiar el código.",
                msg_copy_error_general: "Error de copia: ",
                ok_button: "OK",
                footer_text: "Este sitio fue creado por un gran modelo de lenguaje, entrenado por Google.",
                lang_fr: "Francés",
                lang_en: "Inglés",
                lang_es: "Español",
                lang_zh_CN: "Chino (Simplificado)",
                lang_hi: "Hindi",
                lang_ar: "Árabe",
                lang_bn: "Bengalí",
                lang_pt: "Portugués",
                lang_ru: "Ruso",
                lang_ja: "Japonés",
                lang_de: "Alemán",
                code_comments_line1: "// Código generado para una matriz LED WS2812 de 8x32 (256 píxeles) en zig-zag por columna",
                code_comments_line2: "// Columnas pares: de abajo hacia arriba. Columnas impares: de arriba hacia abajo.",
                code_comments_line3: "// Compatible con la librería Adafruit NeoPixel",
                code_comments_loop1: "// Definición de los colores de los píxeles",
                code_comments_loop2: "// Conversión del lienzo (fila, columna) al índice lineal de NeoPixel según el patrón de zig-zag por columna"
            },
            'zh-CN': {
                title: "LED点阵像素艺术编辑器 (8x32)",
                color_label: "颜色:",
                language_label: "语言:",
                clear_button: "清除所有",
                generate_button: "生成Adafruit代码",
                copy_button: "复制代码",
                theme_toggle: "主题 (深色/浅色)",
                output_placeholder: "生成的Adafruit代码将显示在此处。",
                msg_copied_success: "代码已生成并复制到剪贴板！请粘贴到您的Arduino IDE中。",
                msg_copy_manual: "代码已生成，但自动复制失败。请手动复制。",
                msg_copy_error: "自动复制错误：",
                msg_clipboard_copied: "代码已复制到剪贴板！",
                msg_clipboard_fail: "复制代码失败。",
                msg_copy_error_general: "复制错误：",
                ok_button: "确定",
                footer_text: "本网站由Google训练的大型语言模型创建。",
                lang_fr: "法语",
                lang_en: "英语",
                lang_es: "西班牙语",
                lang_zh_CN: "中文 (简体)",
                lang_hi: "印地语",
                lang_ar: "阿拉伯语",
                lang_bn: "孟加拉语",
                lang_pt: "葡萄牙语",
                lang_ru: "俄语",
                lang_ja: "日语",
                lang_de: "德语",
                code_comments_line1: "// 为8x32 WS2812 LED矩阵（256像素）生成的逐列Z字形代码",
                code_comments_line2: "// 偶数列：从下到上。奇数列：从上到下。",
                code_comments_line3: "// 兼容Adafruit NeoPixel库",
                code_comments_loop1: "// 定义像素颜色",
                code_comments_loop2: "// 根据逐列Z字形模式将画布（行，列）转换为线性NeoPixel索引"
            },
            hi: {
                title: "एलईडी मैट्रिक्स के लिए पिक्सेल आर्ट एडिटर (8x32)",
                color_label: "रंग:",
                language_label: "भाषा:",
                clear_button: "सभी साफ़ करें",
                generate_button: "Adafruit कोड जनरेट करें",
                copy_button: "कोड कॉपी करें",
                theme_toggle: "थीम (गहरा/हल्का)",
                output_placeholder: "जनरेट किया गया Adafruit कोड यहाँ दिखाई देगा।",
                msg_copied_success: "कोड जनरेट किया गया और क्लिपबोर्ड पर कॉपी किया गया! इसे अपने Arduino IDE में पेस्ट करें।",
                msg_copy_manual: "कोड जनरेट किया गया, लेकिन स्वचालित कॉपी विफल रही। कृपया मैन्युअल रूप से कॉपी करें।",
                msg_copy_error: "स्वचालित कॉपी त्रुटि: ",
                msg_clipboard_copied: "कोड क्लिपबोर्ड पर कॉपी किया गया!",
                msg_clipboard_fail: "कोड कॉपी करने में विफल।",
                msg_copy_error_general: "कॉपी त्रुटि: ",
                ok_button: "ठीक है",
                footer_text: "यह साइट Google द्वारा प्रशिक्षित एक बड़े भाषा मॉडल द्वारा बनाई गई थी।",
                lang_fr: "फ्रेंच",
                lang_en: "अंग्रेज़ी",
                lang_es: "स्पेनिश",
                lang_zh_CN: "चीनी (सरलीकृत)",
                lang_hi: "हिंदी",
                lang_ar: "अरबी",
                lang_bn: "बंगाली",
                lang_pt: "पुर्तगाली",
                lang_ru: "रूसी",
                lang_ja: "जापानी",
                lang_de: "जर्मन",
                code_comments_line1: "// 8x32 WS2812 LED मैट्रिक्स (256 पिक्सेल) के लिए कॉलम-वार ज़िग-ज़ैग में जनरेट किया गया कोड",
                code_comments_line2: "// सम कॉलम: नीचे से ऊपर। विषम कॉलम: ऊपर से नीचे।",
                code_comments_line3: "// Adafruit NeoPixel लाइब्रेरी के साथ संगत",
                code_comments_loop1: "// पिक्सेल रंगों को परिभाषित करना",
                code_comments_loop2: "// कॉलम-वार ज़िग-ज़ैग पैटर्न के आधार पर कैनवास (पंक्ति, कॉलम) को रैखिक NeoPixel इंडेक्स में बदलना"
            },
            ar: {
                title: "محرر فن البكسل لمصفوفة LED (8x32)",
                color_label: "اللون:",
                language_label: "اللغة:",
                clear_button: "مسح الكل",
                generate_button: "إنشاء كود Adafruit",
                copy_button: "نسخ الكود",
                theme_toggle: "السمة (داكن/فاتح)",
                output_placeholder: "سيظهر كود Adafruit الذي تم إنشاؤه هنا.",
                msg_copied_success: "تم إنشاء الكود ونسخه إلى الحافظة! الصقه في بيئة تطوير Arduino IDE الخاصة بك.",
                msg_copy_manual: "تم إنشاء الكود، ولكن النسخ التلقائي فشل. يرجى النسخ يدويًا.",
                msg_copy_error: "خطأ في النسخ التلقائي: ",
                msg_clipboard_copied: "تم نسخ الكود إلى الحافظة!",
                msg_clipboard_fail: "فشل نسخ الكود.",
                msg_copy_error_general: "خطأ في النسخ: ",
                ok_button: "موافق",
                footer_text: "تم إنشاء هذا الموقع بواسطة نموذج لغة كبير، تم تدريبه بواسطة Google.",
                lang_fr: "الفرنسية",
                lang_en: "الإنجليزية",
                lang_es: "الإسبانية",
                lang_zh_CN: "الصينية (المبسطة)",
                lang_hi: "الهندية",
                lang_ar: "العربية",
                lang_bn: "البنغالية",
                lang_pt: "البرتغالية",
                lang_ru: "الروسية",
                lang_ja: "اليابانية",
                lang_de: "الألمانية",
                code_comments_line1: "// الكود الذي تم إنشاؤه لمصفوفة WS2812 LED بحجم 8x32 (256 بكسل) بترتيب متعرج عمودي",
                code_comments_line2: "// الأعمدة الزوجية: من الأسفل إلى الأعلى. الأعمدة الفردية: من الأعلى إلى الأسفل.",
                code_comments_line3: "// متوافق مع مكتبة Adafruit NeoPixel",
                code_comments_loop1: "// تحديد ألوان البكسل",
                code_comments_loop2: "// تحويل قماش الرسم (الصف، العمود) إلى فهرس NeoPixel الخطي بناءً على نمط متعرج عمودي"
            },
            bn: {
                title: "এলইডি ম্যাট্রিক্সের জন্য পিক্সেল আর্ট এডিটর (8x32)",
                color_label: "রঙ:",
                language_label: "ভাষা:",
                clear_button: "সব মুছুন",
                generate_button: "Adafruit কোড তৈরি করুন",
                copy_button: "কোড কপি করুন",
                theme_toggle: "থিম (গাঢ়/হালকা)",
                output_placeholder: "জেনারেট করা Adafruit কোড এখানে প্রদর্শিত হবে।",
                msg_copied_success: "কোড তৈরি হয়েছে এবং ক্লিপবোর্ডে কপি করা হয়েছে! আপনার Arduino IDE তে পেস্ট করুন।",
                msg_copy_manual: "কোড তৈরি হয়েছে, কিন্তু স্বয়ংক্রিয় কপি ব্যর্থ হয়েছে। অনুগ্রহ করে ম্যানুয়ালি কপি করুন।",
                msg_copy_error: "স্বয়ংক্রিয় কপি ত্রুটি: ",
                msg_clipboard_copied: "কোড ক্লিপবোর্ডে কপি করা হয়েছে!",
                msg_clipboard_fail: "কোড কপি করতে ব্যর্থ হয়েছে।",
                msg_copy_error_general: "কপি ত্রুটি: ",
                ok_button: "ঠিক আছে",
                footer_text: "এই সাইটটি গুগল দ্বারা প্রশিক্ষিত একটি বৃহৎ ভাষা মডেল দ্বারা তৈরি করা হয়েছে।",
                lang_fr: "ফরাসি",
                lang_en: "ইংরেজি",
                lang_es: "স্প্যানিশ",
                lang_zh_CN: "চীনা (সরলীকৃত)",
                lang_hi: "হিন্দি",
                lang_ar: "আরবি",
                lang_bn: "বাংলা",
                lang_pt: "পর্তুগিজ",
                lang_ru: "রুশ",
                lang_ja: "জাপানি",
                lang_de: "জার্মান",
                code_comments_line1: "// 8x32 WS2812 LED ম্যাট্রিক্স (256 পিক্সেল) এর জন্য কলাম-ভিত্তিক জিগ-জ্যাগ কোড তৈরি করা হয়েছে",
                code_comments_line2: "// জোড় কলাম: নিচ থেকে উপরে। বিজোড় কলাম: উপর থেকে নিচে।",
                code_comments_line3: "// Adafruit NeoPixel লাইব্রেরির সাথে সামঞ্জস্যপূর্ণ",
                code_comments_loop1: "// পিক্সেল রঙ সংজ্ঞায়িত করা হচ্ছে",
                code_comments_loop2: "// কলাম-ভিত্তিক জিগ-জ্যাগ প্যাটার্নের উপর ভিত্তি করে ক্যানভাস (সারি, কলাম) কে লিনিয়ার NeoPixel ইনডেক্সে রূপান্তর করা হচ্ছে"
            },
            pt: {
                title: "Editor de Pixel Art para Matriz LED (8x32)",
                color_label: "Cor:",
                language_label: "Idioma:",
                clear_button: "Limpar Tudo",
                generate_button: "Gerar Código Adafruit",
                copy_button: "Copiar Código",
                theme_toggle: "Tema (Escuro/Claro)",
                output_placeholder: "O código Adafruit gerado aparecerá aqui.",
                msg_copied_success: "Código gerado e copiado para a área de transferência! Cole-o em sua IDE Arduino.",
                msg_copy_manual: "Código gerado, mas a cópia automática falhou. Por favor, copie manualmente.",
                msg_copy_error: "Erro de cópia automática: ",
                msg_clipboard_copied: "Código copiado para a área de transferência!",
                msg_clipboard_fail: "Falha ao copiar o código.",
                msg_copy_error_general: "Erro de cópia: ",
                ok_button: "OK",
                footer_text: "Este site foi criado por um grande modelo de linguagem, treinado pelo Google.",
                lang_fr: "Francês",
                lang_en: "Inglês",
                lang_es: "Espanhol",
                lang_zh_CN: "Chinês (Simplificado)",
                lang_hi: "Hindi",
                lang_ar: "Árabe",
                lang_bn: "Bengalês",
                lang_pt: "Português",
                lang_ru: "Russo",
                lang_ja: "Japonês",
                lang_de: "Alemão",
                code_comments_line1: "// Código gerado para uma matriz LED WS2812 8x32 (256 pixels) em zigue-zague por coluna",
                code_comments_line2: "// Colunas pares: de baixo para cima. Colunas ímpares: de cima para baixo.",
                code_comments_line3: "// Compatível com a biblioteca Adafruit NeoPixel",
                code_comments_loop1: "// Definindo cores dos pixels",
                code_comments_loop2: "// Convertendo canvas (linha, coluna) para índice linear NeoPixel baseado no padrão zigue-zague por coluna"
            },
            ru: {
                title: "Редактор пиксельной графики для LED-матрицы (8x32)",
                color_label: "Цвет:",
                language_label: "Язык:",
                clear_button: "Очистить все",
                generate_button: "Сгенерировать код Adafruit",
                copy_button: "Скопировать код",
                theme_toggle: "Тема (Темная/Светлая)",
                output_placeholder: "Сгенерированный код Adafruit появится здесь.",
                msg_copied_success: "Код сгенерирован и скопирован в буфер обмена! Вставьте его в свою Arduino IDE.",
                msg_copy_manual: "Код сгенерирован, но автоматическое копирование не удалось. Пожалуйста, скопируйте вручную.",
                msg_copy_error: "Ошибка автоматического копирования: ",
                msg_clipboard_copied: "Код скопирован в буфер обмена!",
                msg_clipboard_fail: "Не удалось скопировать код.",
                msg_copy_error_general: "Ошибка копирования: ",
                ok_button: "ОК",
                footer_text: "Этот сайт был создан большой языковой моделью, обученной Google.",
                lang_fr: "Французский",
                lang_en: "Английский",
                lang_es: "Испанский",
                lang_zh_CN: "Китайский (упрощенный)",
                lang_hi: "Хинди",
                lang_ar: "Арабский",
                lang_bn: "Бенгальский",
                lang_pt: "Португальский",
                lang_ru: "Русский",
                lang_ja: "Японский",
                lang_de: "Немецкий",
                code_comments_line1: "// Код сгенерирован для матрицы WS2812 LED 8x32 (256 пикселей) в столбцовом зигзаге",
                code_comments_line2: "// Четные столбцы: снизу вверх. Нечетные столбцы: сверху вниз.",
                code_comments_line3: "// Совместимо с библиотекой Adafruit NeoPixel",
                code_comments_loop1: "// Определение цветов пикселей",
                code_comments_loop2: "// Преобразование холста (строка, столбец) в линейный индекс NeoPixel на основе столбцового зигзаг-шаблона"
            },
            ja: {
                title: "LEDマトリックス用ピクセルアートエディター (8x32)",
                color_label: "色:",
                language_label: "言語:",
                clear_button: "すべてクリア",
                generate_button: "Adafruitコードを生成",
                copy_button: "コードをコピー",
                theme_toggle: "テーマ (ダーク/ライト)",
                output_placeholder: "生成されたAdafruitコードがここに表示されます。",
                msg_copied_success: "コードが生成され、クリップボードにコピーされました！Arduino IDEに貼り付けてください。",
                msg_copy_manual: "コードは生成されましたが、自動コピーに失敗しました。手動でコピーしてください。",
                msg_copy_error: "自動コピーエラー: ",
                msg_clipboard_copied: "コードがクリップボードにコピーされました！",
                msg_clipboard_fail: "コードのコピーに失敗しました。",
                msg_copy_error_general: "コピーエラー: ",
                ok_button: "OK",
                footer_text: "このサイトはGoogleによってトレーニングされた大規模言語モデルによって作成されました。",
                lang_fr: "フランス語",
                lang_en: "英語",
                lang_es: "スペイン語",
                lang_zh_CN: "中国語 (簡体字)",
                lang_hi: "ヒンディー語",
                lang_ar: "アラビア語",
                lang_bn: "ベンガル語",
                lang_pt: "ポルトガル語",
                lang_ru: "ロシア語",
                lang_ja: "日本語",
                lang_de: "ドイツ語",
                code_comments_line1: "// 8x32 WS2812 LEDマトリックス（256ピクセル）用の列ごとのジグザグコード",
                code_comments_line2: "// 偶数列：下から上。奇数列：上から下。",
                code_comments_line3: "// Adafruit NeoPixelライブラリと互換性あり",
                code_comments_loop1: "// ピクセルカラーの定義",
                code_comments_loop2: "// 列ごとのジグザグパターンに基づいてキャンバス（行、列）を線形NeoPixelインデックスに変換"
            },
            de: {
                title: "Pixel Art Editor für LED-Matrix (8x32)",
                color_label: "Farbe:",
                language_label: "Sprache:",
                clear_button: "Alles löschen",
                generate_button: "Adafruit Code generieren",
                copy_button: "Code kopieren",
                theme_toggle: "Thema (Dunkel/Hell)",
                output_placeholder: "Der generierte Adafruit-Code wird hier angezeigt.",
                msg_copied_success: "Code generiert und in die Zwischenablage kopiert! Fügen Sie ihn in Ihre Arduino IDE ein.",
                msg_copy_manual: "Code generiert, aber automatisches Kopieren fehlgeschlagen. Bitte manuell kopieren.",
                msg_copy_error: "Automatischer Kopierfehler: ",
                msg_clipboard_copied: "Code in die Zwischenablage kopiert!",
                msg_clipboard_fail: "Fehler beim Kopieren des Codes.",
                msg_copy_error_general: "Kopierfehler: ",
                ok_button: "OK",
                footer_text: "Diese Website wurde von einem großen Sprachmodell erstellt, das von Google trainiert wurde.",
                lang_fr: "Französisch",
                lang_en: "Englisch",
                lang_es: "Spanisch",
                lang_zh_CN: "Chinesisch (vereinfacht)",
                lang_hi: "Hindi",
                lang_ar: "Arabisch",
                lang_bn: "Bengali",
                lang_pt: "Portugiesisch",
                lang_ru: "Russisch",
                lang_ja: "Japanisch",
                lang_de: "Deutsch",
                code_comments_line1: "// Code generiert für eine 8x32 WS2812 LED-Matrix (256 Pixel) im spaltenweisen Zickzack",
                code_comments_line2: "// Gerade Spalten: von unten nach oben. Ungerade Spalten: von oben nach unten.",
                code_comments_line3: "// Kompatibel mit der Adafruit NeoPixel Bibliothek",
                code_comments_loop1: "// Definieren von Pixelfarben",
                code_comments_loop2: "// Konvertieren von Canvas (Zeile, Spalte) in den linearen NeoPixel-Index basierend auf dem spaltenweisen Zickzack-Muster"
            }
        };

        let currentLang = localStorage.getItem('lang') || 'fr'; // Langue par défaut ou stockée

        /**
         * Fonction pour mettre à jour l'interface utilisateur avec la langue choisie.
         */
        function updateLanguage() {
            const langData = translations[currentLang];

            // Mettre à jour les éléments avec l'attribut data-i18n
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                if (langData[key]) {
                    element.textContent = langData[key];
                }
            });

            // Mettre à jour les placeholders
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                if (langData[key]) {
                    element.placeholder = langData[key];
                }
            });

            // Mettre à jour le sélecteur de langue pour refléter la langue actuelle
            languageSelector.value = currentLang;

            // Mise à jour de la couleur du texte des labels en fonction du thème
            const colorLabel = document.querySelector('.color-picker-wrapper label');
            const langLabel = document.querySelector('.language-selector-wrapper label');

            if (document.body.classList.contains('light-theme')) {
                colorLabel.classList.remove('text-gray-300');
                colorLabel.classList.add('text-gray-700');
                langLabel.classList.remove('text-gray-300');
                langLabel.classList.add('text-gray-700');
            } else {
                colorLabel.classList.remove('text-gray-700');
                colorLabel.classList.add('text-gray-300');
                langLabel.classList.remove('text-gray-700');
                langLabel.classList.add('text-gray-300');
            }

             // Mettre à jour le titre de la page
            document.title = langData.title;
        }


        /**
         * Fonction pour afficher un message à l'utilisateur
         * @param {string} key - La clé de traduction du message.
         * @param {string} [dynamicContent=''] - Contenu dynamique optionnel à ajouter au message.
         */
        function showMessage(key, dynamicContent = '') {
            const message = translations[currentLang][key] + dynamicContent;
            messageText.textContent = message;
            messageBox.style.display = 'flex';
        }

        // Gérer le clic sur le bouton OK de la boîte de message
        messageBoxOk.addEventListener('click', () => {
            messageBox.style.display = 'none';
        });

        /**
         * Dessine la grille de pixels sur le canvas.
         * Chaque pixel est représenté par un carré de PIXEL_SIZE.
         */
        function drawGrid() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // Efface tout le canvas
            for (let r = 0; r < MATRIX_HEIGHT; r++) {
                for (let c = 0; c < MATRIX_WIDTH; c++) {
                    ctx.fillStyle = pixels[r][c]; // Définit la couleur de remplissage du pixel
                    ctx.fillRect(c * PIXEL_SIZE, r * PIXEL_SIZE, PIXEL_SIZE, PIXEL_SIZE); // Dessine le pixel
                    ctx.strokeStyle = '#374151'; // Couleur des bordures de la grille
                    ctx.strokeRect(c * PIXEL_SIZE, r * PIXEL_SIZE, PIXEL_SIZE, PIXEL_SIZE); // Dessine la bordure du pixel
                }
            }
        }

        /**
         * Obtient la position du pixel sur la grille à partir des coordonnées de la souris/touch.
         * @param {number} clientX - Coordonnée X de l'événement.
         * @param {number} clientY - Coordonnée Y de l'événement.
         * @returns {{col: number, row: number} | null} - Les indices de colonne et de ligne du pixel, ou null si hors limites.
         */
        function getPixelCoords(clientX, clientY) {
            const rect = canvas.getBoundingClientRect(); // Obtient la taille et la position du canvas
            const scaleX = canvas.width / rect.width;    // Facteur d'échelle X
            const scaleY = canvas.height / rect.height;  // Facteur d'échelle Y

            // Calcule les coordonnées du clic/touch sur le canvas, en tenant compte de l'échelle
            const x = (clientX - rect.left) * scaleX;
            const y = (clientY - rect.top) * scaleY;

            // Calcule les indices de colonne et de ligne du pixel
            const col = Math.floor(x / PIXEL_SIZE);
            const row = Math.floor(y / PIXEL_SIZE);

            // Vérifie si les coordonnées sont dans les limites de la matrice
            if (col >= 0 && col < MATRIX_WIDTH && row >= 0 && row < MATRIX_HEIGHT) {
                return { col, row };
            }
            return null;
        }

        /**
         * Dessine ou efface un pixel sur la matrice.
         * @param {number} col - Indice de colonne du pixel.
         * @param {number} row - Indice de ligne du pixel.
         * @param {string} color - La couleur à appliquer (hexadécimal).
         */
        function drawPixel(col, row, color) {
            if (col !== null && row !== null) {
                pixels[row][col] = color; // Met à jour la couleur dans la matrice interne
                drawGrid(); // Redessine la grille pour afficher le changement
            }
        }

        // Événements de souris pour le dessin
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            const coords = getPixelCoords(e.clientX, e.clientY);
            if (coords) {
                drawPixel(coords.col, coords.row, colorPicker.value);
            }
        });

        canvas.addEventListener('mousemove', (e) => {
            if (isDrawing) {
                const coords = getPixelCoords(e.clientX, e.clientY);
                if (coords) {
                    drawPixel(coords.col, coords.row, colorPicker.value);
                }
            }
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
        });

        canvas.addEventListener('mouseleave', () => {
            isDrawing = false;
        });

        // Événements tactiles pour le dessin (pour les appareils mobiles)
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault(); // Empêche le défilement et le zoom
            isDrawing = true;
            const touch = e.touches[0];
            const coords = getPixelCoords(touch.clientX, touch.clientY);
            if (coords) {
                drawPixel(coords.col, coords.row, colorPicker.value);
            }
        });

        canvas.addEventListener('touchmove', (e) => {
            e.preventDefault(); // Empêche le défilement et le zoom
            if (isDrawing) {
                const touch = e.touches[0];
                const coords = getPixelCoords(touch.clientX, touch.clientY);
                if (coords) {
                    drawPixel(coords.col, coords.row, colorPicker.value);
                }
            }
        });

        canvas.addEventListener('touchend', () => {
            isDrawing = false;
        });

        /**
         * Convertit une couleur hexadécimale (#RRGGBB) en un entier 32 bits (0xRRGGBB).
         * @param {string} hex - La couleur hexadécimale.
         * @returns {string} - La représentation hexadécimale de l'entier 32 bits.
         */
        function hexToUint32(hex) {
            // Supprime le '#' si présent
            const cleanHex = hex.startsWith('#') ? hex.substring(1) : hex;
            // Convertit en entier, puis formate en hexadécimal avec un préfixe 0x et 6 chiffres
            return '0x' + cleanHex.toUpperCase();
        }

        /**
         * Génère le code Adafruit compatible avec la matrice LED 8x32 en zig-zag colonne par colonne.
         * La première colonne est lue du bas vers le haut.
         * La deuxième colonne est lue du haut vers le bas.
         * La troisième colonne du bas vers le haut, et ainsi de suite.
         *
         * Le dessin sur le canvas est de haut en bas, gauche à droite.
         * La conversion adapte les coordonnées du canvas à cet ordre physique.
         */
        generateButton.addEventListener('click', () => {
            const langData = translations[currentLang];
            let adafruitCode = `${langData.code_comments_line1}\n`;
            adafruitCode += `${langData.code_comments_line2}\n`;
            adafruitCode += `${langData.code_comments_line3}\n\n`;
            adafruitCode += `#include <Adafruit_NeoPixel.h>\n\n`;
            adafruitCode += `#define PIN        6   // Broche de données pour les NeoPixels\n`;
            adafruitCode += `#define NUMPIXELS  ${MATRIX_WIDTH * MATRIX_HEIGHT} // Nombre total de pixels\n\n`;
            adafruitCode += `Adafruit_NeoPixel pixels(NUMPIXELS, PIN, NEO_GRB + NEO_KHZ800);\n\n`;
            adafruitCode += `void setup() {\n`;
            adafruitCode += `  pixels.begin(); // Initialise la bibliothèque NeoPixel\n`;
            adafruitCode += `}\n\n`;
            adafruitCode += `void loop() {\n`;

            adafruitCode += `  ${langData.code_comments_loop1}\n`;
            adafruitCode += `  ${langData.code_comments_loop2}\n`;

            // Tableau temporaire pour stocker les couleurs dans l'ordre linéaire Adafruit
            let linearPixels = new Array(NUMPIXELS);

            for (let col = 0; col < MATRIX_WIDTH; col++) { // Parcourt les colonnes physiques
                if (col % 2 === 0) { // Colonne paire (0, 2, ...) -> lecture du bas vers le haut
                    for (let row_idx_in_column = 0; row_idx_in_column < MATRIX_HEIGHT; row_idx_in_column++) {
                        // Pour aller du bas vers le haut, la rangée du canvas est inversée
                        const canvas_row = MATRIX_HEIGHT - 1 - row_idx_in_column;
                        const linearIndex = col * MATRIX_HEIGHT + row_idx_in_column;
                        linearPixels[linearIndex] = hexToUint32(pixels[canvas_row][col]);
                    }
                } else { // Colonne impaire (1, 3, ...) -> lecture du haut vers le bas
                    for (let row_idx_in_column = 0; row_idx_in_column < MATRIX_HEIGHT; row_idx_in_column++) {
                        // Pour aller du haut vers le bas, la rangée du canvas est directe
                        const canvas_row = row_idx_in_column;
                        const linearIndex = col * MATRIX_HEIGHT + row_idx_in_column;
                        linearPixels[linearIndex] = hexToUint32(pixels[canvas_row][col]);
                    }
                }
            }

            // Générer le code Adafruit setPixelColor
            for (let i = 0; i < NUMPIXELS; i++) {
                adafruitCode += `  pixels.setPixelColor(${i}, ${linearPixels[i]});\n`;
            }

            adafruitCode += `  pixels.show(); // Affiche les couleurs sur les LEDs\n`;
            adafruitCode += `  delay(100); // Petite pause (ajuster si nécessaire)\n`;
            adafruitCode += `}\n`;

            outputCode.value = adafruitCode; // Affiche le code généré dans la zone de texte

            // Copier le code automatiquement après la génération
            outputCode.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('msg_copied_success');
                } else {
                    showMessage('msg_copy_manual');
                }
            } catch (err) {
                showMessage('msg_copy_error', err);
            }
        });

        // Effacer tout le dessin
        clearButton.addEventListener('click', () => {
            pixels = Array(MATRIX_HEIGHT).fill(0).map(() => Array(MATRIX_WIDTH).fill('#000000'));
            drawGrid();
            outputCode.value = ''; // Efface également le code généré
        });

        // Copier le code dans le presse-papiers (bouton séparé, désormais aussi appelé par generateButton)
        copyButton.addEventListener('click', () => {
            outputCode.select(); // Sélectionne tout le texte dans la zone de texte
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showMessage('msg_clipboard_copied');
                } else {
                    showMessage('msg_clipboard_fail');
                }
            } catch (err) {
                showMessage('msg_copy_error_general', err);
            }
        });

        // Fonction pour basculer le thème
        themeToggleButton.addEventListener('click', () => {
            document.body.classList.toggle('light-theme');
            // Mettre à jour la couleur du texte des labels en fonction du thème
            const colorLabel = document.querySelector('.color-picker-wrapper label');
            const langLabel = document.querySelector('.language-selector-wrapper label');

            if (document.body.classList.contains('light-theme')) {
                colorLabel.classList.remove('text-gray-300');
                colorLabel.classList.add('text-gray-700');
                langLabel.classList.remove('text-gray-300');
                langLabel.classList.add('text-gray-700');
            } else {
                colorLabel.classList.remove('text-gray-700');
                colorLabel.classList.add('text-gray-300');
                langLabel.classList.remove('text-gray-700');
                langLabel.classList.add('text-gray-300');
            }
        });

        // Gérer le changement de langue
        languageSelector.addEventListener('change', (e) => {
            currentLang = e.target.value;
            localStorage.setItem('lang', currentLang); // Sauvegarde la préférence
            updateLanguage(); // Met à jour l'UI
        });

        // Initialiser la palette de couleurs prédéfinies
        function initializeColorPalette() {
            predefinedColors.forEach(color => {
                const colorBox = document.createElement('div');
                colorBox.classList.add('color-box');
                colorBox.style.backgroundColor = color;
                colorBox.dataset.color = color; // Stocke la couleur pour un accès facile
                colorBox.addEventListener('click', () => {
                    colorPicker.value = color; // Met à jour le sélecteur de couleurs
                    updateSelectedColorBox(); // Met à jour la sélection visuelle
                });
                colorPalette.appendChild(colorBox);
            });
            updateSelectedColorBox(); // Initialiser la sélection visuelle
        }

        // Met à jour la classe 'selected' sur la boîte de couleur actuellement choisie
        function updateSelectedColorBox() {
            document.querySelectorAll('.color-box').forEach(box => {
                if (box.dataset.color.toLowerCase() === colorPicker.value.toLowerCase()) {
                    box.classList.add('selected');
                } else {
                    box.classList.remove('selected');
                }
            });
        }

        // Met à jour la sélection de la boîte de couleur lorsque le sélecteur de couleur principal change
        colorPicker.addEventListener('input', updateSelectedColorBox);


        // Initialiser la grille, la palette et la langue au chargement de la page
        window.onload = () => {
            canvas.width = MATRIX_WIDTH * PIXEL_SIZE;
            canvas.height = MATRIX_HEIGHT * PIXEL_SIZE;
            drawGrid();
            initializeColorPalette();
            updateLanguage(); // Appelle la fonction de traduction au démarrage
        };

        // Gérer le redimensionnement de la fenêtre pour ajuster la taille du canvas
        window.addEventListener('resize', () => {
            // Pas besoin de redessiner la grille si la taille du canvas est fixe
            // Si le canvas devait être redimensionné dynamiquement, il faudrait le faire ici
        });

    </script>
</body>
</html>
